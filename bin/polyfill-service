#!/usr/bin/env node
'use strict';

require('dotenv').config();

const packageJSON = require('../package.json');
const startService = require('../service');

const portString = process.env.PORT || "3000";
const port = portString.startsWith("/") ? portString : Number(portString);

process.on('uncaughtException', (err) => {
  console.log('uncaught exception', err.stack || err);
});

startService(port, function(err, app){
	if (err) {
		console.error(err);
		process.exit(1);
	}

	// This output is string-matched by the service.js task
	console.log(packageJSON.name + '@' + packageJSON.version + ' started [procstatus:started]' ,'pid='+process.pid, 'port='+port, 'env='+ app.get('env'));
});
